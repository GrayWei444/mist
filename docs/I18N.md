# Mist å¤šèªç³»è¨­è¨ˆ (i18n)

## 1. æŠ€è¡“é¸å‹

| é …ç›® | é¸æ“‡ | èªªæ˜ |
|------|------|------|
| æ¡†æ¶ | react-i18next | ç”Ÿæ…‹ç³»æœ€å¤§ã€åŠŸèƒ½å®Œæ•´ |
| æ ¼å¼ | JSON | ç°¡å–®æ˜“ç¶­è­· |
| è¼‰å…¥ | æ‡¶åŠ è¼‰ (Lazy Loading) | åªè¼‰å…¥ç•¶å‰èªè¨€ï¼Œæ¸›å°‘åˆå§‹è¼‰å…¥ |
| åµæ¸¬ | è‡ªå‹•åµæ¸¬ | ç€è¦½å™¨èªè¨€ â†’ localStorage â†’ é è¨­ |

## 2. æ”¯æ´èªç³»è¦åŠƒ

### Phase 4 åˆæœŸ

| èªè¨€ | ä»£ç¢¼ | å„ªå…ˆç´š | èªªæ˜ |
|------|------|--------|------|
| ç¹é«”ä¸­æ–‡ | `zh-TW` | P0 | é è¨­èªè¨€ |
| è‹±æ–‡ | `en` | P0 | åœ‹éš›ç”¨æˆ¶ |
| ç°¡é«”ä¸­æ–‡ | `zh-CN` | P1 | å¤§ä¸­è¯å€ |
| æ—¥æ–‡ | `ja` | P2 | æ±äºå¸‚å ´ |

### æœªä¾†æ“´å±•

| èªè¨€ | ä»£ç¢¼ | èªªæ˜ |
|------|------|------|
| éŸ“æ–‡ | `ko` | éš±ç§æ„è­˜é«˜çš„å¸‚å ´ |
| å¾·æ–‡ | `de` | æ­æ´²éš±ç§é‡è¦–åœ‹å®¶ |
| è¥¿ç­ç‰™æ–‡ | `es` | è¦†è“‹æ‹‰ä¸ç¾æ´² |
| æ³•æ–‡ | `fr` | è¦†è“‹æ³•èªå€ |

## 3. ç›®éŒ„çµæ§‹

```
src/
â”œâ”€â”€ locales/
â”‚   â”œâ”€â”€ zh-TW/
â”‚   â”‚   â”œâ”€â”€ common.json      # å…±ç”¨æ–‡å­—ï¼ˆæŒ‰éˆ•ã€æ¨™é¡Œç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ chat.json        # èŠå¤©ç›¸é—œ
â”‚   â”‚   â”œâ”€â”€ contacts.json    # è¯çµ¡äººç›¸é—œ
â”‚   â”‚   â”œâ”€â”€ settings.json    # è¨­å®šé é¢
â”‚   â”‚   â”œâ”€â”€ auth.json        # èªè­‰ç›¸é—œ
â”‚   â”‚   â””â”€â”€ errors.json      # éŒ¯èª¤è¨Šæ¯
â”‚   â”œâ”€â”€ en/
â”‚   â”‚   â”œâ”€â”€ common.json
â”‚   â”‚   â”œâ”€â”€ chat.json
â”‚   â”‚   â”œâ”€â”€ contacts.json
â”‚   â”‚   â”œâ”€â”€ settings.json
â”‚   â”‚   â”œâ”€â”€ auth.json
â”‚   â”‚   â””â”€â”€ errors.json
â”‚   â”œâ”€â”€ zh-CN/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ja/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ index.ts             # i18n åˆå§‹åŒ–è¨­å®š
â”‚   â””â”€â”€ languages.ts         # èªè¨€åˆ—è¡¨èˆ‡è¨­å®š
```

## 4. è¨­å®šæª”

### i18n/index.ts

```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import Backend from 'i18next-http-backend';

i18n
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    fallbackLng: 'zh-TW',
    supportedLngs: ['zh-TW', 'en', 'zh-CN', 'ja'],
    
    ns: ['common', 'chat', 'contacts', 'settings', 'auth', 'errors'],
    defaultNS: 'common',
    
    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json',
    },
    
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      caches: ['localStorage'],
    },
    
    interpolation: {
      escapeValue: false, // React å·²ç¶“è™•ç† XSS
    },
  });

export default i18n;
```

### i18n/languages.ts

```typescript
export const languages = [
  { code: 'zh-TW', name: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼' },
  { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
  { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
] as const;

export type LanguageCode = typeof languages[number]['code'];
```

## 5. èªè¨€æª”ç¯„ä¾‹

### locales/zh-TW/common.json

```json
{
  "app_name": "Mist",
  "tagline": "æœ¦æœ§ä¹‹ä¸­ï¼Œåªæœ‰ä½ æˆ‘",
  "loading": "è¼‰å…¥ä¸­...",
  "error": "ç™¼ç”ŸéŒ¯èª¤",
  "retry": "é‡è©¦",
  "cancel": "å–æ¶ˆ",
  "confirm": "ç¢ºèª",
  "save": "å„²å­˜",
  "delete": "åˆªé™¤",
  "back": "è¿”å›",
  "next": "ä¸‹ä¸€æ­¥",
  "done": "å®Œæˆ",
  "search": "æœå°‹",
  "no_results": "æ²’æœ‰çµæœ"
}
```

### locales/en/common.json

```json
{
  "app_name": "Mist",
  "tagline": "In the mist, only you and me",
  "loading": "Loading...",
  "error": "An error occurred",
  "retry": "Retry",
  "cancel": "Cancel",
  "confirm": "Confirm",
  "save": "Save",
  "delete": "Delete",
  "back": "Back",
  "next": "Next",
  "done": "Done",
  "search": "Search",
  "no_results": "No results"
}
```

### locales/zh-TW/chat.json

```json
{
  "title": "èŠå¤©",
  "new_message": "æ–°è¨Šæ¯",
  "type_message": "è¼¸å…¥è¨Šæ¯...",
  "send": "å‚³é€",
  "read": "å·²è®€",
  "delivered": "å·²é€é”",
  "sending": "å‚³é€ä¸­...",
  "message_deleted": "è¨Šæ¯å·²åˆªé™¤",
  "burn_after_read": "é–±å¾Œå³ç„š",
  "ttl": {
    "1h": "1 å°æ™‚å¾Œåˆªé™¤",
    "1d": "1 å¤©å¾Œåˆªé™¤",
    "1w": "1 é€±å¾Œåˆªé™¤",
    "1m": "1 å€‹æœˆå¾Œåˆªé™¤",
    "forever": "æ°¸ä¹…ä¿ç•™"
  },
  "file": {
    "sending": "å‚³é€æª”æ¡ˆä¸­...",
    "received": "æ”¶åˆ°æª”æ¡ˆ",
    "download": "ä¸‹è¼‰",
    "open": "é–‹å•Ÿ"
  }
}
```

### locales/en/chat.json

```json
{
  "title": "Chats",
  "new_message": "New Message",
  "type_message": "Type a message...",
  "send": "Send",
  "read": "Read",
  "delivered": "Delivered",
  "sending": "Sending...",
  "message_deleted": "Message deleted",
  "burn_after_read": "Burn after read",
  "ttl": {
    "1h": "Delete after 1 hour",
    "1d": "Delete after 1 day",
    "1w": "Delete after 1 week",
    "1m": "Delete after 1 month",
    "forever": "Keep forever"
  },
  "file": {
    "sending": "Sending file...",
    "received": "File received",
    "download": "Download",
    "open": "Open"
  }
}
```

## 6. å…ƒä»¶ä½¿ç”¨ç¯„ä¾‹

### åŸºæœ¬ç”¨æ³•

```tsx
import { useTranslation } from 'react-i18next';

function ChatHeader() {
  const { t } = useTranslation('chat');
  
  return (
    <header>
      <h1>{t('title')}</h1>
    </header>
  );
}
```

### å¸¶åƒæ•¸

```tsx
// JSON: "welcome": "æ­¡è¿ï¼Œ{{name}}ï¼"
function Welcome({ name }: { name: string }) {
  const { t } = useTranslation();
  
  return <p>{t('welcome', { name })}</p>;
}
```

### è¤‡æ•¸å½¢å¼

```tsx
// JSON: "messages_count": "{{count}} å‰‡è¨Šæ¯"
// JSON: "messages_count_plural": "{{count}} å‰‡è¨Šæ¯"
function MessageCount({ count }: { count: number }) {
  const { t } = useTranslation();
  
  return <span>{t('messages_count', { count })}</span>;
}
```

### åˆ‡æ›èªè¨€

```tsx
import { useTranslation } from 'react-i18next';
import { languages } from '@/i18n/languages';

function LanguageSwitcher() {
  const { i18n } = useTranslation();
  
  return (
    <select 
      value={i18n.language}
      onChange={(e) => i18n.changeLanguage(e.target.value)}
    >
      {languages.map((lang) => (
        <option key={lang.code} value={lang.code}>
          {lang.flag} {lang.name}
        </option>
      ))}
    </select>
  );
}
```

## 7. é–‹ç™¼è¦ç¯„

### å‘½åè¦å‰‡

| é¡å‹ | è¦å‰‡ | ç¯„ä¾‹ |
|------|------|------|
| æŒ‰éˆ• | `btn_å‹•ä½œ` æˆ–ç›´æ¥å‹•ä½œ | `save`, `delete`, `btn_submit` |
| æ¨™é¡Œ | `title` æˆ– `é é¢_title` | `title`, `settings_title` |
| è¨Šæ¯ | `msg_æè¿°` | `msg_success`, `msg_error` |
| éŒ¯èª¤ | `error_ä»£ç¢¼` | `error_network`, `error_auth` |
| æç¤º | `hint_æè¿°` | `hint_password` |

### æ³¨æ„äº‹é …

1. **ä¸è¦ç¡¬ç·¨ç¢¼æ–‡å­—** - æ‰€æœ‰ UI æ–‡å­—éƒ½è¦æ”¾åˆ°èªè¨€æª”
2. **ä¿æŒ key èªæ„åŒ–** - è®“å…¶ä»–é–‹ç™¼è€…å®¹æ˜“ç†è§£
3. **åˆ†æª”ç®¡ç†** - ä¾åŠŸèƒ½æ¨¡çµ„åˆ†é–‹ï¼Œé¿å…å–®ä¸€å¤§æª”æ¡ˆ
4. **é¿å…å·¢ç‹€éæ·±** - æœ€å¤š 2-3 å±¤
5. **çµ±ä¸€ä½¿ç”¨è‹±æ–‡ key** - å³ä½¿é è¨­æ˜¯ä¸­æ–‡

### ç¿»è­¯æµç¨‹

```
1. é–‹ç™¼è€…åœ¨ zh-TW/ æ–°å¢æ–‡å­—
2. å®ŒæˆåŠŸèƒ½å¾Œï¼ŒåŒæ­¥ç¿»è­¯åˆ° en/
3. å…¶ä»–èªè¨€å¯å¾ŒçºŒè£œä¸Šæˆ–ä½¿ç”¨ç¿»è­¯æœå‹™
4. PR æ™‚æª¢æŸ¥æ‰€æœ‰èªè¨€æª” key æ˜¯å¦ä¸€è‡´
```

## 8. ä¾è³´å¥—ä»¶

```json
{
  "dependencies": {
    "i18next": "^23.0.0",
    "react-i18next": "^14.0.0",
    "i18next-browser-languagedetector": "^7.0.0",
    "i18next-http-backend": "^2.0.0"
  }
}
```

## 9. TypeScript å‹åˆ¥å®‰å…¨ï¼ˆå¯é¸ï¼‰

å¦‚éœ€å‹åˆ¥æª¢æŸ¥ç¿»è­¯ keyï¼Œå¯å®‰è£ï¼š

```bash
pnpm add -D i18next-parser
```

ä¸¦è¨­å®šè‡ªå‹•ç”Ÿæˆå‹åˆ¥å®šç¾©ã€‚
