# Mist 未來功能規劃

> 本文件記錄 Phase 4 之後的功能規劃與設計決策
> 最後更新：2024-12-12

---

## 1. 產品雙軌定位

開發兩個獨立品牌產品，共享核心技術：

```
┌─────────────────────────────────────────────────────────────────┐
│                        雙品牌策略                                │
├────────────────────────────┬────────────────────────────────────┤
│         🌫️ Mist             │         🛡️ SafeTalk               │
│      (個人隱私通訊)          │        (企業安全通訊)              │
├────────────────────────────┼────────────────────────────────────┤
│ 目標用戶：一般個人           │ 目標用戶：企業/組織               │
│ 平台：PWA (Web App)         │ 平台：原生 App 或 PWA             │
├────────────────────────────┼────────────────────────────────────┤
│ ✅ 端到端加密               │ ✅ 端到端加密                      │
│ ✅ 閱後即焚                 │ ❌ 訊息需留存稽核                  │
│ ✅ 天氣偽裝模式             │ ❌ 不需要偽裝                      │
│ ✅ 長按顯示訊息             │ ❌ 正常顯示                        │
│ ✅ 防詐騙                   │ ✅✅ 強化防詐騙                    │
│ ✅ 好友 5000+               │ ✅ 組織架構管理                    │
│ ✅ 巢狀群組                 │ ✅✅ 強化群組功能                  │
│                            │ ✅ 管理員權限                      │
│                            │ ✅ 管理後台                        │
├────────────────────────────┼────────────────────────────────────┤
│ 類似：Signal               │ 類似：Slack、企業微信              │
└────────────────────────────┴────────────────────────────────────┘
```

### 1.1 共同核心價值

兩個產品都強調：

| 核心價值 | 說明 |
|----------|------|
| 🔒 安全性 | 端到端加密，伺服器零知識 |
| 🛡️ 防詐騙 | 帳號無法被盜，聊的一定是本人 |
| ☁️ 資料不上雲 | P2P 架構，訊息不經伺服器 |
| 💰 低營運成本 | P2P 架構省下儲存和頻寬成本 |

### 1.2 Mist vs SafeTalk 差異

| 功能 | 🌫️ Mist | 🛡️ SafeTalk |
|------|---------|-------------|
| 訊息加密 | ✅ E2EE | ✅ E2EE |
| 閱後即焚 | ✅ | ❌ 需稽核 |
| 訊息留存 | 用戶控制 | 公司可設定保留期 |
| 偽裝模式 | ✅ 天氣 App | ❌ |
| 長按顯示 | ✅ | ❌ |
| 身份驗證 | 🟡 可選 | ✅ 強制實名 |
| 組織架構 | ❌ | ✅ 部門/團隊 |
| 管理後台 | ❌ | ✅ |
| 平台 | PWA | 原生 App / PWA |

### 1.3 開發優先級

```
Phase 4-7: 先完成 Mist
    ↓
Phase 8+: 基於 Mist 核心開發 SafeTalk
    └── 移除隱私功能
    └── 加入企業功能
    └── 評估是否需要原生 App
```

---

## 2. 核心差異化功能

### 2.1 防詐騙 / 真實身份驗證

**這是 Mist 最強的差異化，沒有競品做到。**

#### 競品的身份驗證漏洞

| App | 驗證方式 | 漏洞 |
|-----|----------|------|
| LINE | 手機 + 密碼 | 密碼被釣魚、SIM Swap |
| Telegram | 手機 + 2FA | 可被社交工程 |
| WhatsApp | 手機 | SIM Swap |
| Discord | Email + 密碼 | 釣魚網站 |

#### Mist 的防盜機制

```
手機號碼驗證
    +
生物辨識 WebAuthn（設備綁定）
    +
Ed25519 私鑰（永不離開設備）
    =
帳號無法被盜 🔒
```

| 攻擊方式 | LINE | Mist |
|----------|------|------|
| 密碼釣魚 | ❌ 易中招 | ✅ 沒有密碼 |
| SIM Swap | ❌ 可盜 | ✅ 需要生物辨識 |
| 遠端盜取 | ❌ 可能 | ✅ 私鑰不離開設備 |
| 社交工程 | ❌ 可能 | ✅ 生物辨識無法騙 |

#### 防詐騙應用場景

| 場景 | 痛點 | Mist 解法 |
|------|------|-----------|
| 家人聯繫 | 「爸我被綁架」詐騙 | 帳號一定是本人 |
| 商務溝通 | 冒充老闆/同事詐騙 | 無法冒充 |
| 網友交友 | 假帳號、照騙 | 已驗證身份 |
| 金融對話 | 釣魚連結盜帳號 | 無法盜帳號發訊息 |

#### 品牌訊息

```
「朦朧之中，只有你我」

隱私 × 防詐 × 真實身份

- 端到端加密，沒人能偷看
- 帳號無法被盜，聊的一定是本人
```

---

### 2.2 好友數量無上限（5000+）

**目標**：突破 LINE 5000 好友限制

#### 競品好友上限

| App | 好友上限 |
|-----|----------|
| LINE | 5,000 |
| WeChat | 10,000 |
| Discord | 1,000 |
| Facebook | 5,000 |
| **Mist** | **無上限** |

#### 技術可行性

因為 P2P 架構，好友數量不影響伺服器成本：

| 項目 | 策略 |
|------|------|
| Ratchet 狀態 | 只存活躍對話，其他按需載入 |
| MQTT 訂閱 | 分頁訂閱，只訂閱在線/活躍好友 |
| 金鑰初始化 | 按需建立 X3DH，不預先初始化 |
| 好友同步 | 增量同步，非全量同步 |
| UI 列表 | 虛擬捲動 (Virtual Scroll) |

#### 關鍵洞察

```
好友數量 ≠ 同時連線數

5000 好友
├── 同時在線：~50-100 人
├── 活躍對話：~10-20 個
└── 實際 WebRTC 連線：< 10 個
```

---

### 2.3 巢狀群組 (Nested Groups)

**目標**：解決 LINE/Telegram 沒有群組層級結構的痛點，這是獨家功能。

#### 設計決策

| 項目 | 決定 |
|------|------|
| 訊息傳遞方向 | 只能向下廣播，不能向上 |
| 發送選項 | 可選「僅本群」或「含子群」 |
| 成員關係 | 繼承模式：子群成員自動屬於父群 |
| 金鑰管理 | 每個群組獨立金鑰 |

#### 訊息傳遞規則

```
發送到「工程部」
├── 選「僅本群」→ 只有工程部成員收到
└── 選「含子群」→ 前端組、後端組成員也收到

發送到「前端組」
└── 父群「工程部」不會收到（不能向上廣播）
```

#### 群組結構範例

```
📁 公司
 ├── 💬 全公司公告 (50人)
 └── 📁 工程部
      ├── 💬 工程部全體 (12人)
      ├── 💬 前端組 (4人)
      └── 💬 後端組 (6人)

📁 家族
 ├── 💬 全家族 (15人)
 └── 📁 爸媽那邊
      ├── 💬 爸媽 (3人)
      └── 💬 表哥表姐 (5人)
```

---

## 3. P2P 架構成本優勢

### 3.1 傳統 vs Mist 架構

**傳統通訊軟體（LINE、Telegram）**

```
用戶 A → 伺服器 → 用戶 B
           ↓
       儲存訊息 💸
       儲存檔案 💸💸
       頻寬成本 💸💸💸
```

**Mist（P2P 架構）**

```
用戶 A ←──── P2P ────→ 用戶 B

伺服器只做：
├── MQTT 信令（極輕量）
└── TURN 中繼（備援）
```

### 3.2 成本對比

| 功能 | 傳統架構成本 | Mist 成本 |
|------|-------------|-----------|
| 訊息儲存 | 💸💸💸 | ❌ 不存 |
| 檔案儲存 | 💸💸💸 | ❌ 不存 |
| 好友 5000+ | 💸 同步/推播成本 | ✅ 本地儲存，幾乎免費 |
| 傳大檔案 | 💸💸 伺服器儲存 | ✅ P2P 直傳，免費 |
| 訊息量大 | 💸💸💸 全經伺服器 | ✅ P2P，只有信令 |

### 3.3 Mist 實際成本

```
1. MQTT Broker (EMQX)  → 輕量，低成本
2. TURN Server         → P2P 失敗時的備援
3. 基礎 VPS            → 固定成本
```

---

## 4. TURN 中繼技術考量

### 4.1 STUN vs TURN

| | STUN | TURN |
|--|------|------|
| 作用 | 發現公網 IP/Port | 中繼轉發流量 |
| 成本 | 幾乎免費 | 💸 流量經伺服器 |
| 成功率 | ~80-85% | ~99% |
| 何時用 | NAT 可穿透 | NAT 穿透失敗 |

### 4.2 NAT 穿透失敗場景

```
STUN 失敗的情況：

1. 對稱 NAT (Symmetric NAT)
   └── 企業網路、部分 4G 基地台

2. 嚴格防火牆
   └── 公司網路、學校、特定地區

3. 雙方都在嚴格 NAT 後
   └── 無法直接打洞
```

### 4.3 群組為何更需要 TURN

**機率問題：**

```
1 對 1：
├── 連線成功率 85%
└── 只需 1 條連線

8 人群組：
├── 需要 28 條連線
├── 每條 85% 成功率
└── 全部成功：0.85^28 ≈ 1%
    至少 1 條失敗：99%
```

群組裡總會有人在嚴格網路環境（公司、4G、防火牆後）。

### 4.4 IPv6 的影響

| 問題 | 現實 |
|------|------|
| 部署不完整 | 很多地方還是 IPv4 |
| 防火牆 | IPv6 還是會被擋 |
| 行動網路 | 運營商實作不一 |

### 4.5 優化策略

| 策略 | 效果 |
|------|------|
| ICE Trickle | 更快找到可用路徑 |
| TURN 只給失敗的連線 | 不是全部走 TURN |
| 選擇性轉發 (SFU) | 大群組更省頻寬 |
| IPv6 優先 | 減少 NAT 問題 |

---

## 5. 商業模式

### 5.1 核心概念

```
P2P 架構 = 低營運成本
         ↓
可以更大方提供功能
         ↓
1 對 1 免費，群組付費
```

### 5.2 Freemium 定價（草案）

| 功能 | 免費版 | 付費版 |
|------|--------|--------|
| 1對1 加密聊天 | ✅ 無限 | ✅ 無限 |
| 好友數量 | 無上限 | 無上限 |
| 檔案傳輸 | ✅ 無限制 | ✅ 無限制 |
| 群組功能 | ❌ | ✅ |
| 巢狀群組 | ❌ | ✅ |

### 5.3 定價方案（草案）

| 方案 | 群組功能 | 價格 |
|------|----------|------|
| 免費版 | ❌ | $0 |
| 輕量版 | 3 個群組 | NT$ 180/年 |
| 標準版 | 無限群組 | NT$ 480/年 |
| 專業版 | 無限+巢狀群組 | NT$ 960/年 |
| 企業版 | 全功能+管理後台 | 另議 |

### 5.4 收費邏輯

| 為何這樣收 | 原因 |
|------------|------|
| 1對1 免費 | P2P 架構成本極低 |
| 好友無上限 | 本地儲存，不影響伺服器 |
| 檔案不限 | P2P 直傳，伺服器不經手 |
| 群組收費 | TURN 備援有真實成本 |

---

## 6. 競品差異化總結

| 差異化功能 | LINE | Telegram | Signal | Discord | **Mist** |
|------------|------|----------|--------|---------|----------|
| E2EE | 部分 | 部分 | ✅ | ❌ | ✅ |
| 防詐騙/防盜帳號 | ❌ | ❌ | ❌ | ❌ | **✅** |
| 好友 5000+ | ❌ | ？ | ？ | ❌ | **✅** |
| 巢狀群組 | ❌ | ❌ | ❌ | ❌ | **✅** |
| 閱後即焚 | ❌ | ✅ | ✅ | ❌ | ✅ |
| 偽裝模式 | ❌ | ❌ | ❌ | ❌ | **✅** |
| 低伺服器成本 | ❌ | ❌ | ❌ | ❌ | **✅** |

---

## 7. 開發優先級

```
Phase 4: 完整 E2E 聊天流程（當前）
    ↓
Phase 5: 商業化（Mist）
    ├── 金流整合（綠界 + LemonSqueezy）
    └── 新定價方案實作
    ↓
Phase 6: 好友 5000+（Mist）
    ├── 惰性載入優化
    ├── 增量同步
    └── 虛擬列表 UI
    ↓
Phase 7: 巢狀群組（Mist）
    ├── 群組樹狀結構
    ├── 向下廣播邏輯
    └── 獨立金鑰管理
    ↓
Phase 8+: SafeTalk（新品牌）
    ├── 基於 Mist 核心代碼 fork
    ├── 移除隱私功能（偽裝、閱後即焚、長按顯示）
    ├── 管理後台
    ├── 組織架構
    ├── 訊息留存政策
    └── 評估原生 App 需求
```

---

## 8. 待決定事項

### Mist 相關
- [ ] 免費版是否提供群組試用期？
- [ ] 巢狀群組是否獨立收費？
- [ ] QR Code 加好友是否延長時效（目前 5 分鐘）
- [ ] 父群管理員是否自動管理子群

### SafeTalk 相關
- [ ] SafeTalk 定價策略（按人頭？按公司？）
- [ ] SafeTalk 平台選擇（原生 App vs PWA vs 兩者都做）
- [ ] SafeTalk 是否需要獨立的 MQTT Broker / TURN Server
- [ ] SafeTalk 管理後台功能範圍

---

*文件版本：1.1*
*最後更新：2024-12-12*
